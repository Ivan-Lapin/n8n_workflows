# Автоматическое обновление данных из OptiOffice

## Описание
Этот рабочий процесс (workflow) автоматизирует обработку и перенос данных из отчетов OptiOffice (PDF) в централизованную таблицу Microsoft Excel. Workflow специализируется на обработке производственных показателей операторов лесозаготовительной техники.

## Принцип работы

### 1. Мониторинг новых отчетов
- Постоянное отслеживание новых файлов в папке Google Drive
- Целевая папка: "Отчёты по операторам"
- Частота проверки: каждую минуту
- Отслеживание: создание новых файлов

### 2. Многоэтапная обработка данных

#### 2.1. Работа с PDF
1. **Получение файла**
   - Автоматическая загрузка нового PDF-файла из Google Drive
   - Подготовка к конвертации

2. **Конвертация PDF в изображение**
   - Использование сервиса PDF.co для конвертации PDF в JPG
   - Извлечение URL полученного изображения

#### 2.2. Анализ данных
1. **Обработка изображения с помощью AI**
   - Использование OpenAI GPT-4 для распознавания текста и данных
   - Извлечение ключевых показателей:
     * ФИО оператора
     * Эффективное время G15
     * Рабочее время
     * Средняя крепость
     * Количество стволов
     * Период отчета (месяц и год)

2. **Структурирование данных**
   - Конвертация текстовых данных в JSON формат
   - Нормализация значений (удаление лишних символов, преобразование форматов)
   - Стандартизация имен операторов

### 3. Обновление целевой таблицы
- Название таблицы: "Эффективность заготовки"
- Поиск соответствующей строки по ФИО оператора
- Обновление следующих показателей:
  * Средний объем хлыста
  * Количество стволов
  * Рабочее время (G, мч)
  * Эффективное время (G15, мч)

## Особенности и преимущества
1. **Автоматизация полного цикла**
   - От обнаружения нового отчета до обновления базы данных
   - Минимизация ручного вмешательства

2. **Интеллектуальная обработка**
   - Использование AI для точного распознавания данных
   - Поддержка сложного формата отчетов OptiOffice

3. **Надежность обработки данных**
   - Проверка корректности извлеченных значений
   - Форматирование данных перед записью
   - Сохранение исходной точности значений

## Обработка ошибок
- Валидация формата входных PDF-файлов
- Проверка качества конвертации в изображение
- Верификация распознанных данных
- Контроль корректности обновления целевой таблицы

## Требуемые интеграции
1. Google Drive API (доступ к отчетам)
2. PDF.co API (конвертация PDF)
3. OpenAI API (распознавание данных)
4. Microsoft Excel OAuth2 (работа с целевой таблицей)

## Входные данные
- Формат: PDF-файлы из OptiOffice
- Расположение: Папка "Отчёты по операторам" в Google Drive
- Требования к отчетам:
  * Должны содержать все необходимые метрики
  * Стандартный формат OptiOffice
  * Четкое указание периода и оператора

## Выходные данные
- Обновленные записи в таблице "Эффективность заготовки"
- Актуализация всех производственных показателей
- Сохранение истории по месяцам

## Примечание по безопасности
Для корректной работы workflow необходимо настроить учетные данные для всех используемых сервисов и обеспечить соответствующие уровни доступа к файлам и папкам.

## Рекомендации по использованию
1. Регулярно проверять актуальность учетных данных для всех сервисов
2. Следить за форматом загружаемых отчетов
3. Периодически верифицировать корректность обновления данных
4. Поддерживать структуру папок в Google Drive